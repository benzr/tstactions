# .github/workflows/workflow-b.yml
name: Workflow B - Receiver

on:
  workflow_run:
    workflows: ["Workflow A - Sender"]
    types:
      - completed

permissions:
  actions: read  # Required to download artifacts from other workflows
  contents: write  # Required to upload artifacts

jobs:
  process-artifact:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Download artifact from Workflow A
        uses: actions/download-artifact@v4
        with:
          # This downloads from the triggering workflow run (Workflow A)
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}
          name: shared-data-from-a
          path: ./downloaded-artifact
          
      - name: Display original content
        run: |
          echo "Original content from Workflow A:"
          cat downloaded-artifact/shared-data.txt
          
      - name: Modify the content
        run: |
          # Change "sent" to "received"
          sed -i 's/sent/received/' downloaded-artifact/shared-data.txt
          echo "Modified content:"
          cat downloaded-artifact/shared-data.txt
          
      - name: Create a new artifact
        run: |
          # Create a new file or modify the existing one
          cp downloaded-artifact/shared-data.txt modified-data.txt
          echo "Timestamp: $(date)" >> modified-data.txt
          
      - name: Upload modified artifact
        uses: actions/upload-artifact@v4
        with:
          name: processed-data-from-b
          path: modified-data.txt
          retention-days: 1
          
      - name: Summary
        run: |
          echo "Successfully processed artifact from Workflow A"
          echo "Workflow A run ID: ${{ github.event.workflow_run.id }}"
          echo "Workflow B run ID: ${{ github.run_id }}"