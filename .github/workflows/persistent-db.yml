name: Workflow with artifact persistence

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # Daily

jobs:
  process-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Download previous database artifact
        uses: actions/download-artifact@v4
        with:
          name: sqlite-database
          path: ./
        continue-on-error: true  # First run won't have artifact

      - name: Setup database
        run: |
          if [ ! -f database.db ]; then
            sqlite3 database.db "CREATE TABLE logs (id INTEGER PRIMARY KEY, timestamp TEXT, event TEXT);"
          fi
          
          # Your workflow logic
          sqlite3 database.db "INSERT INTO logs (timestamp, event) VALUES (datetime('now'), 'workflow_started');"

      - name: Upload updated database
        uses: actions/upload-artifact@v4
        with:
          name: sqlite-database
          path: database.db
          retention-days: 90  # Keep for 90 days